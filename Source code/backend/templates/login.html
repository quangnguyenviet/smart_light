<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Light - ÄÄƒng nháº­p</title>

    <!-- THÃŠM: Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      body {
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>

  <body class="bg-gradient-to-br from-indigo-600 to-blue-600 min-h-screen flex items-center justify-center p-4">
    <!-- THÃŠM: Container chÃ­nh -->
    <div class="w-full max-w-md">
      <!-- THÃŠM: Card Ä‘Äƒng nháº­p/Ä‘Äƒng kÃ­ -->
      <div class="bg-white rounded-xl shadow-2xl overflow-hidden">
        <!-- THÃŠM: Header vá»›i logo -->
        <div class="bg-indigo-700 text-white p-8 text-center">
          <h1 class="text-4xl font-extrabold">ğŸ </h1>
          <h2 class="text-2xl font-bold mt-2">Smart Light Control</h2>
        </div>

        <!-- THÃŠM: Tab chuyá»ƒn Ä‘á»•i login/register -->
        <div class="flex border-b">
          <button
            id="login-tab"
            class="flex-1 py-4 px-6 text-center font-semibold bg-indigo-50 text-indigo-700 border-b-2 border-indigo-700 cursor-pointer"
            onclick="switchTab('login')"
          >
            ÄÄƒng Nháº­p
          </button>
          <button
            id="register-tab"
            class="flex-1 py-4 px-6 text-center font-semibold text-gray-600 hover:bg-gray-50 cursor-pointer"
            onclick="switchTab('register')"
          >
            ÄÄƒng KÃ­
          </button>
        </div>

        <!-- THÃŠM: Ná»™i dung form -->
        <div class="p-8">
          <!-- THÃŠM: Form Ä‘Äƒng nháº­p -->
          <div id="login-form" class="space-y-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                TÃªn Ä‘Äƒng nháº­p
              </label>
              <!-- THÃŠM: Input username Ä‘Äƒng nháº­p -->
              <input
                id="login-username"
                type="text"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600"
                placeholder="Nháº­p tÃªn Ä‘Äƒng nháº­p"
              />
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                Máº­t kháº©u
              </label>
              <!-- THÃŠM: Input password Ä‘Äƒng nháº­p -->
              <input
                id="login-password"
                type="password"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600"
                placeholder="Nháº­p máº­t kháº©u"
              />
            </div>

            <!-- THÃŠM: Message box cho lá»—i/thÃ nh cÃ´ng -->
            <div
              id="login-message"
              class="p-3 rounded-lg text-sm hidden text-center"
            ></div>

            <!-- THÃŠM: NÃºt Ä‘Äƒng nháº­p -->
            <button
              class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition"
              onclick="handleLogin()"
            >
              ÄÄƒng Nháº­p
            </button>
          </div>

          <!-- THÃŠM: Form Ä‘Äƒng kÃ­ -->
          <div id="register-form" class="space-y-4 hidden">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                TÃªn Ä‘Äƒng nháº­p
              </label>
              <!-- THÃŠM: Input username Ä‘Äƒng kÃ­ -->
              <input
                id="register-username"
                type="text"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600"
                placeholder="Nháº­p tÃªn Ä‘Äƒng nháº­p (tá»‘i thiá»ƒu 3 kÃ½ tá»±)"
              />
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                Email
              </label>
              <!-- THÃŠM: Input email (tÃ¹y chá»n) -->
              <input
                id="register-email"
                type="email"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600"
                placeholder="Email (tÃ¹y chá»n)"
              />
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                Máº­t kháº©u
              </label>
              <!-- THÃŠM: Input password Ä‘Äƒng kÃ­ -->
              <input
                id="register-password"
                type="password"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600"
                placeholder="Nháº­p máº­t kháº©u (tá»‘i thiá»ƒu 6 kÃ½ tá»±)"
              />
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                XÃ¡c nháº­n máº­t kháº©u
              </label>
              <!-- THÃŠM: Input password confirm -->
              <input
                id="register-password-confirm"
                type="password"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600"
                placeholder="Nháº­p láº¡i máº­t kháº©u"
              />
            </div>

            <!-- THÃŠM: Message box cho lá»—i/thÃ nh cÃ´ng -->
            <div
              id="register-message"
              class="p-3 rounded-lg text-sm hidden text-center"
            ></div>

            <!-- THÃŠM: NÃºt Ä‘Äƒng kÃ­ -->
            <button
              class="w-full bg-green-600 text-white font-semibold py-3 rounded-lg hover:bg-green-700 transition"
              onclick="handleRegister()"
            >
              ÄÄƒng KÃ­
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- THÃŠM: Script xá»­ lÃ½ logic -->
    <script>
      // THÃŠM: HÃ m chuyá»ƒn Ä‘á»•i tab login/register
      function switchTab(tab) {
        const loginForm = document.getElementById("login-form");
        const registerForm = document.getElementById("register-form");
        const loginTab = document.getElementById("login-tab");
        const registerTab = document.getElementById("register-tab");

        // THÃŠM: áº¨n/hiá»‡n form tÆ°Æ¡ng á»©ng
        if (tab === "login") {
          loginForm.classList.remove("hidden");
          registerForm.classList.add("hidden");
          loginTab.classList.add("bg-indigo-50", "text-indigo-700", "border-b-2", "border-indigo-700");
          loginTab.classList.remove("text-gray-600", "hover:bg-gray-50");
          registerTab.classList.remove("bg-indigo-50", "text-indigo-700", "border-b-2", "border-indigo-700");
          registerTab.classList.add("text-gray-600", "hover:bg-gray-50");
        } else {
          registerForm.classList.remove("hidden");
          loginForm.classList.add("hidden");
          registerTab.classList.add("bg-indigo-50", "text-indigo-700", "border-b-2", "border-indigo-700");
          registerTab.classList.remove("text-gray-600", "hover:bg-gray-50");
          loginTab.classList.remove("bg-indigo-50", "text-indigo-700", "border-b-2", "border-indigo-700");
          loginTab.classList.add("text-gray-600", "hover:bg-gray-50");
        }
      }

      // THÃŠM: HÃ m hiá»ƒn thá»‹ message
      function showMessage(elementId, message, isError) {
        const messageBox = document.getElementById(elementId);
        messageBox.textContent = message;
        messageBox.classList.remove("hidden");
        
        // THÃŠM: Äá»•i mÃ u dá»±a trÃªn lá»—i hay thÃ nh cÃ´ng
        if (isError) {
          messageBox.classList.remove("bg-green-100", "text-green-800");
          messageBox.classList.add("bg-red-100", "text-red-800");
        } else {
          messageBox.classList.remove("bg-red-100", "text-red-800");
          messageBox.classList.add("bg-green-100", "text-green-800");
        }
      }

      // THÃŠM: HÃ m xá»­ lÃ½ Ä‘Äƒng nháº­p
      function handleLogin() {
        const username = document.getElementById("login-username").value.trim();
        const password = document.getElementById("login-password").value;

        // THÃŠM: Validation cÆ¡ báº£n
        if (!username || !password) {
          showMessage("login-message", "Vui lÃ²ng nháº­p tÃªn Ä‘Äƒng nháº­p vÃ  máº­t kháº©u", true);
          return;
        }

        // THÃŠM: Gá»­i request Ä‘Äƒng nháº­p Ä‘áº¿n server
        fetch("/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.error) {
              // THÃŠM: Hiá»ƒn thá»‹ lá»—i náº¿u Ä‘Äƒng nháº­p tháº¥t báº¡i
              showMessage("login-message", data.error, true);
            } else {
              // THÃŠM: Redirect Ä‘áº¿n trang chÃ­nh náº¿u Ä‘Äƒng nháº­p thÃ nh cÃ´ng
              showMessage("login-message", data.message, false);
              setTimeout(() => {
                window.location.href = "/";
              }, 1000);
            }
          })
          .catch((err) => {
            // THÃŠM: Xá»­ lÃ½ lá»—i network
            showMessage("login-message", "Lá»—i káº¿t ná»‘i", true);
            console.error(err);
          });
      }

      // THÃŠM: HÃ m xá»­ lÃ½ Ä‘Äƒng kÃ­
      function handleRegister() {
        const username = document.getElementById("register-username").value.trim();
        const email = document.getElementById("register-email").value.trim();
        const password = document.getElementById("register-password").value;
        const passwordConfirm = document.getElementById("register-password-confirm").value;

        // THÃŠM: Validation cÆ¡ báº£n
        if (!username || !password || !passwordConfirm) {
          showMessage("register-message", "Vui lÃ²ng nháº­p tÃªn Ä‘Äƒng nháº­p, máº­t kháº©u vÃ  xÃ¡c nháº­n", true);
          return;
        }

        // THÃŠM: Kiá»ƒm tra Ä‘á»™ dÃ i username
        if (username.length < 3) {
          showMessage("register-message", "TÃªn Ä‘Äƒng nháº­p pháº£i Ã­t nháº¥t 3 kÃ½ tá»±", true);
          return;
        }

        // THÃŠM: Kiá»ƒm tra Ä‘á»™ dÃ i password
        if (password.length < 6) {
          showMessage("register-message", "Máº­t kháº©u pháº£i Ã­t nháº¥t 6 kÃ½ tá»±", true);
          return;
        }

        // THÃŠM: Kiá»ƒm tra xÃ¡c nháº­n máº­t kháº©u
        if (password !== passwordConfirm) {
          showMessage("register-message", "Máº­t kháº©u xÃ¡c nháº­n khÃ´ng trÃ¹ng", true);
          return;
        }

        // THÃŠM: Gá»­i request Ä‘Äƒng kÃ­ Ä‘áº¿n server
        fetch("/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            username,
            email: email || null,
            password,
            password_confirm: passwordConfirm,
          }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.error) {
              // THÃŠM: Hiá»ƒn thá»‹ lá»—i náº¿u Ä‘Äƒng kÃ­ tháº¥t báº¡i
              showMessage("register-message", data.error, true);
            } else {
              // THÃŠM: Redirect Ä‘áº¿n trang chÃ­nh náº¿u Ä‘Äƒng kÃ­ thÃ nh cÃ´ng
              showMessage("register-message", data.message, false);
              setTimeout(() => {
                window.location.href = "/";
              }, 1000);
            }
          })
          .catch((err) => {
            // THÃŠM: Xá»­ lÃ½ lá»—i network
            showMessage("register-message", "Lá»—i káº¿t ná»‘i", true);
            console.error(err);
          });
      }

      // THÃŠM: Cho phÃ©p nháº¥n Enter Ä‘á»ƒ Ä‘Äƒng nháº­p/Ä‘Äƒng kÃ­
      document.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          const loginForm = document.getElementById("login-form");
          const registerForm = document.getElementById("register-form");

          // THÃŠM: Kiá»ƒm tra form nÃ o Ä‘ang hiá»ƒn thá»‹
          if (!loginForm.classList.contains("hidden")) {
            handleLogin();
          } else if (!registerForm.classList.contains("hidden")) {
            handleRegister();
          }
        }
      });
    </script>
  </body>
</html>
